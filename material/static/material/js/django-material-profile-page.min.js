!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("frontend"),require("Stimulus"),require("Turbolinks")):"function"==typeof define&&define.amd?define(["frontend","Stimulus","Turbolinks"],e):"object"==typeof exports?exports.frontend=e(require("frontend"),require("Stimulus"),require("Turbolinks")):t.frontend=e(t.frontend,t.Stimulus,t.Turbolinks)}("undefined"!=typeof self?self:this,function(t,e,r){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(1),o=(r.n(n),r(2));n.application.register("dmc-profile-avatar",o.a)},function(e,r){e.exports=t},function(t,e,r){"use strict";var n=r(3),o=(r.n(n),r(4)),i=r.n(o),a=r(5),s=r.n(a),h=function(){function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}();function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}var c=function(t){function e(){var t,r,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var o=arguments.length,i=Array(o),a=0;a<o;a++)i[a]=arguments[a];return r=n=u(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(i))),n.onChangeAvatarClick=function(t){var e=t.target.files;0!==e.length&&-1!==e[0].type.indexOf("image")||n.showError("No images selected");var r=new FileReader;r.onload=function(t){var e=new Image;e.onload=function(){n._crop(e).then(function(t){n._upload(t)}).catch(function(t){n._showError(t.message||"Image cropping error")})},e.src=t.target.result},r.readAsDataURL(e[0])},u(n,r)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,n["Controller"]),h(e,[{key:"initialize",value:function(){this._uploadButtonEl=this.element.querySelector(".dmc-profile-avatar__change"),this._formEl=this.element.querySelector("form")}},{key:"connect",value:function(){this._uploadButtonEl.addEventListener("change",this.onChangeAvatarClick)}},{key:"disconnect",value:function(){this._uploadButtonEl.removeEventListener("change",this.onChangeAvatarClick)}},{key:"_crop",value:function(t,e){return i.a.crop(t,{minScale:1,width:256,height:256}).then(function(e){var r=document.createElement("canvas");return r.width=256,r.height=256,r.getContext("2d").drawImage(t,e.topCrop.x,e.topCrop.y,e.topCrop.width,e.topCrop.height,0,0,256,256),r})}},{key:"_upload",value:function(t){var e=this;this._uploadButtonEl.classList.toggle("dmc-profile-avatar__change--disabled");var r=new XMLHttpRequest;r.open("POST",window.location.search,!0),r.setRequestHeader("Turbolinks-Referrer",window.location),r.onload=function(t){var e=r.getResponseHeader("turbolinks-location"),n=window.Turbolinks.Snapshot.wrap(r.response);e||(e=window.location.href),window.Turbolinks.controller.adapter.hideProgressBar(),window.Turbolinks.controller.cache.put(e,n),window.Turbolinks.visit(e,{action:"restore"}),window.Turbolinks.clearCache(),r.status>299&&s.a.controller.disable()},r.onerror=function(t){window.Turbolinks.controller.adapter.hideProgressBar(),e.uploadButton_.classList.toggle("dmc-profile-avatar__change--disabled"),e.showError("Request error")},window.Turbolinks.controller.adapter.showProgressBarAfterDelay(),t.toBlob(function(t){var n=new FormData(e._formEl);n.append("avatar",t,"avatar.jpg"),r.send(n)})}},{key:"_showError",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,r=new CustomEvent("DMCSnackbar:show",{detail:{message:t,timeout:e}});window.dispatchEvent(r)}}]),e}();e.a=c},function(t,r){t.exports=e},function(t,e,r){var n;!function(){"use strict";var o={};function i(t,e,r){for(var n=r.data,o=r.width,i=~~t.x,a=~~(t.x+t.width),s=~~t.y,h=~~(t.y+t.height),u=255*t.weight,c=s;c<h;c++)for(var l=i;l<a;l++){n[4*(c*o+l)+3]+=u}}function a(t,e,r){for(var n={detail:0,saturation:0,skin:0,boost:0,total:0},o=e.data,i=t.scoreDownSample,a=1/i,h=e.height*i,u=e.width*i,c=e.width,l=0;l<h;l+=i)for(var d=0;d<u;d+=i){var f=4*(~~(l*a)*c+~~(d*a)),p=s(t,r,d,l),g=o[f+1]/255;n.skin+=o[f]/255*(g+t.skinBias)*p,n.detail+=g*p,n.saturation+=o[f+2]/255*(g+t.saturationBias)*p,n.boost+=o[f+3]/255*p}return n.total=(n.detail*t.detailWeight+n.skin*t.skinWeight+n.saturation*t.saturationWeight+n.boost*t.boostWeight)/(r.width*r.height),n}function s(t,e,r,n){if(e.x>r||r>=e.x+e.width||e.y>n||n>=e.y+e.height)return t.outsideImportance;r=(r-e.x)/e.width,n=(n-e.y)/e.height;var o=2*g(.5-r),i=2*g(.5-n),a=Math.max(o-1+t.edgeRadius,0),s=Math.max(i-1+t.edgeRadius,0),h=(a*a+s*s)*t.edgeWeight,u=1.41-v(o*o+i*i);return t.ruleOfThirds&&(u+=1.2*Math.max(0,u+h+.5)*(m(o)+m(i))),u+h}function h(t,e,r,n){var o=v(e*e+r*r+n*n),i=e/o-t.skinColor[0],a=r/o-t.skinColor[1],s=n/o-t.skinColor[2];return 1-v(i*i+a*a+s*s)}function u(t,e,r){this.width=t,this.height=e,this.data=r?new Uint8ClampedArray(r):new Uint8ClampedArray(t*e*4)}function c(t,e){for(var r=t.data,n=t.width,o=Math.floor(t.width/e),i=Math.floor(t.height/e),a=new u(o,i),s=a.data,h=1/(e*e),c=0;c<i;c++)for(var l=0;l<o;l++){for(var d=4*(c*o+l),f=0,p=0,g=0,v=0,w=0,m=0,b=0,y=0;y<e;y++)for(var x=0;x<e;x++){var k=4*((c*e+y)*n+(l*e+x));f+=r[k],p+=r[k+1],g+=r[k+2],v+=r[k+3],w=Math.max(w,r[k]),m=Math.max(m,r[k+1]),b=Math.max(b,r[k+2])}s[d]=f*h*.5+.5*w,s[d+1]=p*h*.7+.3*m,s[d+2]=g*h,s[d+3]=v*h}return a}function l(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r}function d(t){return{open:function(e){var r=e.naturalWidth||e.width,n=e.naturalHeight||e.height,i=t(r,n),a=i.getContext("2d");return!e.naturalWidth||e.naturalWidth==e.width&&e.naturalHeight==e.height?(i.width=e.width,i.height=e.height):(i.width=e.naturalWidth,i.height=e.naturalHeight),a.drawImage(e,0,0),o.Promise.resolve(i)},resample:function(e,r,n){return Promise.resolve(e).then(function(e){var i=t(~~r,~~n);return i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,i.width,i.height),o.Promise.resolve(i)})},getData:function(t){return Promise.resolve(t).then(function(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height);return new u(t.width,t.height,e.data)})}}}o.Promise="undefined"!=typeof Promise?Promise:function(){throw new Error("No native promises and smartcrop.Promise not set.")},o.DEFAULTS={width:0,height:0,aspect:0,cropWidth:0,cropHeight:0,detailWeight:.2,skinColor:[.78,.57,.44],skinBias:.01,skinBrightnessMin:.2,skinBrightnessMax:1,skinThreshold:.8,skinWeight:1.8,saturationBrightnessMin:.05,saturationBrightnessMax:.9,saturationThreshold:.4,saturationBias:.2,saturationWeight:.3,scoreDownSample:8,step:8,scaleStep:.1,minScale:1,maxScale:1,edgeRadius:.4,edgeWeight:-20,outsideImportance:-.5,boostWeight:100,ruleOfThirds:!0,prescale:!0,imageOperations:null,canvasFactory:l,debug:!1},o.crop=function(t,e,r){var n=w({},o.DEFAULTS,e);n.aspect&&(n.width=n.aspect,n.height=1),null===n.imageOperations&&(n.imageOperations=d(n.canvasFactory));var s=n.imageOperations,l=1,g=1;return s.open(t,n.input).then(function(t){return n.width&&n.height&&(l=f(t.width/n.width,t.height/n.height),n.cropWidth=~~(n.width*l),n.cropHeight=~~(n.height*l),n.minScale=f(n.maxScale,p(1/l,n.minScale)),!1!==n.prescale&&((g=1/l/n.minScale)<1?(t=s.resample(t,t.width*g,t.height*g),n.cropWidth=~~(n.cropWidth*g),n.cropHeight=~~(n.cropHeight*g),n.boost&&(n.boost=n.boost.map(function(t){return{x:~~(t.x*g),y:~~(t.y*g),width:~~(t.width*g),height:~~(t.height*g),weight:t.weight}}))):g=1)),t}).then(function(t){return s.getData(t).then(function(t){for(var e=function(t,e){var r={},n=new u(e.width,e.height);(function(t,e){for(var r=t.data,n=e.data,o=t.width,i=t.height,a=0;a<i;a++)for(var s=0;s<o;s++){var h,u=4*(a*o+s);h=0===s||s>=o-1||0===a||a>=i-1?y(r,u):4*y(r,u)-y(r,u-4*o)-y(r,u-4)-y(r,u+4)-y(r,u+4*o),n[u+1]=h}})(e,n),function(t,e,r){for(var n=e.data,o=r.data,i=e.width,a=e.height,s=0;s<a;s++)for(var u=0;u<i;u++){var c=4*(s*i+u),l=b(n[c],n[c+1],n[c+2])/255,d=h(t,n[c],n[c+1],n[c+2]),f=d>t.skinThreshold,p=l>=t.skinBrightnessMin&&l<=t.skinBrightnessMax;o[c]=f&&p?(d-t.skinThreshold)*(255/(1-t.skinThreshold)):0}}(t,e,n),function(t,e,r){for(var n=e.data,o=r.data,i=e.width,a=e.height,s=0;s<a;s++)for(var h=0;h<i;h++){var u=4*(s*i+h),c=b(n[u],n[u+1],n[u+2])/255,l=x(n[u],n[u+1],n[u+2]),d=(t.saturationThreshold,c>=t.saturationBrightnessMin&&c<=t.saturationBrightnessMax);o[u+2]=d&&d?(l-t.saturationThreshold)*(255/(1-t.saturationThreshold)):0}}(t,e,n),function(t,e){if(!t.boost)return;for(var r=e.data,n=0;n<e.width;n+=4)r[n+3]=0;for(n=0;n<t.boost.length;n++)i(t.boost[n],t,e)}(t,n);for(var o=c(n,t.scoreDownSample),s=-1/0,l=null,d=function(t,e,r){for(var n=[],o=f(e,r),i=t.cropWidth||o,a=t.cropHeight||o,s=t.maxScale;s>=t.minScale;s-=t.scaleStep)for(var h=0;h+a*s<=r;h+=t.step)for(var u=0;u+i*s<=e;u+=t.step)n.push({x:u,y:h,width:i*s,height:a*s});return n}(t,e.width,e.height),p=0,g=d.length;p<g;p++){var v=d[p];v.score=a(t,o,v),v.score.total>s&&(l=v,s=v.score.total)}r.topCrop=l,t.debug&&l&&(r.crops=d,r.debugOutput=n,r.debugOptions=t,r.debugTopCrop=w({},r.topCrop));return r}(n,t),o=e.crops||[e.topCrop],s=0,l=o.length;s<l;s++){var d=o[s];d.x=~~(d.x/g),d.y=~~(d.y/g),d.width=~~(d.width/g),d.height=~~(d.height/g)}return r&&r(e),e})})},o.isAvailable=function(t){if(!o.Promise)return!1;if((t?t.canvasFactory:l)===l&&!document.createElement("canvas").getContext("2d"))return!1;return!0},o.importance=s,o.ImgData=u,o._downSample=c,o._canvasImageOperations=d;var f=Math.min,p=Math.max,g=Math.abs,v=(Math.ceil,Math.sqrt);function w(t){for(var e=1,r=arguments.length;e<r;e++){var n=arguments[e];if(n)for(var o in n)t[o]=n[o]}return t}function m(t){return t=16*((t-1/3+1)%2*.5-.5),Math.max(1-t*t,0)}function b(t,e,r){return.5126*r+.7152*e+.0722*t}function y(t,e){return b(t[e],t[e+1],t[e+2])}function x(t,e,r){var n=p(t/255,e/255,r/255),o=f(t/255,e/255,r/255);if(n===o)return 0;var i=n-o;return(n+o)/2>.5?i/(2-n-o):i/(n+o)}void 0===(n=function(){return o}.call(e,r,e,t))||(t.exports=n),e.smartcrop=o,t.exports=o}()},function(t,e){t.exports=r}])});
//# sourceMappingURL=django-material-profile-page.min.js.map