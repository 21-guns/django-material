function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var exports={};!function(){"use strict";function t(t,e){for(var r=t.data,a=e.data,o=t.width,n=t.height,i=0;i<n;i++)for(var h=0;h<o;h++){var s,u=4*(i*o+h);s=0===h||h>=o-1||0===i||i>=n-1?v(r,u):4*v(r,u)-v(r,u-4*o)-v(r,u-4)-v(r,u+4)-v(r,u+4*o),a[u+1]=s}}function e(t,e,r){for(var a=e.data,o=r.data,n=e.width,i=e.height,h=0;h<i;h++)for(var u=0;u<n;u++){var d=4*(h*n+u),c=w(a[d],a[d+1],a[d+2])/255,l=s(t,a[d],a[d+1],a[d+2]),g=l>t.skinThreshold,f=c>=t.skinBrightnessMin&&c<=t.skinBrightnessMax;g&&f?o[d]=(l-t.skinThreshold)*(255/(1-t.skinThreshold)):o[d]=0}}function r(t,e,r){for(var a=e.data,o=r.data,n=e.width,i=e.height,h=0;h<i;h++)for(var s=0;s<n;s++){var u=4*(h*n+s),d=w(a[u],a[u+1],a[u+2])/255,c=m(a[u],a[u+1],a[u+2]),l=(c>t.saturationThreshold,d>=t.saturationBrightnessMin&&d<=t.saturationBrightnessMax);l&&l?o[u+2]=(c-t.saturationThreshold)*(255/(1-t.saturationThreshold)):o[u+2]=0}}function a(t,e){if(t.boost){for(var r=e.data,a=0;a<e.width;a+=4)r[a+3]=0;for(a=0;a<t.boost.length;a++)o(t.boost[a],t,e)}}function o(t,e,r){for(var a=r.data,o=r.width,n=~~t.x,i=~~(t.x+t.width),h=~~t.y,s=~~(t.y+t.height),u=255*t.weight,d=h;d<s;d++)for(var c=n;c<i;c++){var l=4*(d*o+c);a[l+3]+=u}}function n(t,e,r){for(var a=[],o=k(e,r),n=t.cropWidth||o,i=t.cropHeight||o,h=t.maxScale;h>=t.minScale;h-=t.scaleStep)for(var s=0;s+i*h<=r;s+=t.step)for(var u=0;u+n*h<=e;u+=t.step)a.push({x:u,y:s,width:n*h,height:i*h});return a}function i(t,e,r){for(var a={detail:0,saturation:0,skin:0,boost:0,total:0},o=e.data,n=t.scoreDownSample,i=1/n,s=e.height*n,u=e.width*n,d=e.width,c=0;c<s;c+=n)for(var l=0;l<u;l+=n){var g=4*(~~(c*i)*d+~~(l*i)),f=h(t,r,l,c),p=o[g+1]/255;a.skin+=o[g]/255*(p+t.skinBias)*f,a.detail+=p*f,a.saturation+=o[g+2]/255*(p+t.saturationBias)*f,a.boost+=o[g+3]/255*f}return a.total=(a.detail*t.detailWeight+a.skin*t.skinWeight+a.saturation*t.saturationWeight+a.boost*t.boostWeight)/(r.width*r.height),a}function h(t,e,r,a){if(e.x>r||r>=e.x+e.width||e.y>a||a>=e.y+e.height)return t.outsideImportance;r=(r-e.x)/e.width,a=(a-e.y)/e.height;var o=2*C(.5-r),n=2*C(.5-a),i=Math.max(o-1+t.edgeRadius,0),h=Math.max(n-1+t.edgeRadius,0),s=(i*i+h*h)*t.edgeWeight,u=1.41-y(o*o+n*n);return t.ruleOfThirds&&(u+=1.2*Math.max(0,u+s+.5)*(p(o)+p(n))),u+s}function s(t,e,r,a){var o=y(e*e+r*r+a*a),n=e/o-t.skinColor[0],i=r/o-t.skinColor[1],h=a/o-t.skinColor[2],s=y(n*n+i*i+h*h);return 1-s}function u(o,h){var s={},u=new d(h.width,h.height);t(h,u),e(o,h,u),r(o,h,u),a(o,u);for(var l=c(u,o.scoreDownSample),g=-(1/0),p=null,w=n(o,h.width,h.height),v=0,m=w.length;v<m;v++){var b=w[v];b.score=i(o,l,b),b.score.total>g&&(p=b,g=b.score.total)}return s.topCrop=p,o.debug&&p&&(s.crops=w,s.debugOutput=u,s.debugOptions=o,s.debugTopCrop=f({},s.topCrop)),s}function d(t,e,r){this.width=t,this.height=e,r?this.data=new Uint8ClampedArray(r):this.data=new Uint8ClampedArray(t*e*4)}function c(t,e){for(var r=t.data,a=t.width,o=Math.floor(t.width/e),n=Math.floor(t.height/e),i=new d(o,n),h=i.data,s=1/(e*e),u=0;u<n;u++)for(var c=0;c<o;c++){for(var l=4*(u*o+c),g=0,f=0,p=0,w=0,v=0,m=0,b=0,k=0;k<e;k++)for(var x=0;x<e;x++){var C=4*((u*e+k)*a+(c*e+x));g+=r[C],f+=r[C+1],p+=r[C+2],w+=r[C+3],v=Math.max(v,r[C]),m=Math.max(m,r[C+1]),b=Math.max(b,r[C+2])}h[l]=g*s*.5+.5*v,h[l+1]=f*s*.7+.3*m,h[l+2]=p*s,h[l+3]=w*s}return i}function l(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r}function g(t){return{open:function(e){var r=e.naturalWidth||e.width,a=e.naturalHeight||e.height,o=t(r,a),n=o.getContext("2d");return!e.naturalWidth||e.naturalWidth==e.width&&e.naturalHeight==e.height?(o.width=e.width,o.height=e.height):(o.width=e.naturalWidth,o.height=e.naturalHeight),n.drawImage(e,0,0),b.Promise.resolve(o)},resample:function(e,r,a){return Promise.resolve(e).then(function(e){var o=t(~~r,~~a),n=o.getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,o.width,o.height),b.Promise.resolve(o)})},getData:function(t){return Promise.resolve(t).then(function(t){var e=t.getContext("2d"),r=e.getImageData(0,0,t.width,t.height);return new d(t.width,t.height,r.data)})}}}function f(t){for(var e=1,r=arguments.length;e<r;e++){var a=arguments[e];if(a)for(var o in a)t[o]=a[o]}return t}function p(t){return t=16*((t-1/3+1)%2*.5-.5),Math.max(1-t*t,0)}function w(t,e,r){return.5126*r+.7152*e+.0722*t}function v(t,e){return w(t[e],t[e+1],t[e+2])}function m(t,e,r){var a=x(t/255,e/255,r/255),o=k(t/255,e/255,r/255);if(a===o)return 0;var n=(a+o)/2,i=a-o;return n>.5?i/(2-a-o):i/(a+o)}var b={};b.Promise="undefined"!=typeof Promise?Promise:function(){throw new Error("No native promises and smartcrop.Promise not set.")},b.DEFAULTS={width:0,height:0,aspect:0,cropWidth:0,cropHeight:0,detailWeight:.2,skinColor:[.78,.57,.44],skinBias:.01,skinBrightnessMin:.2,skinBrightnessMax:1,skinThreshold:.8,skinWeight:1.8,saturationBrightnessMin:.05,saturationBrightnessMax:.9,saturationThreshold:.4,saturationBias:.2,saturationWeight:.3,scoreDownSample:8,step:8,scaleStep:.1,minScale:1,maxScale:1,edgeRadius:.4,edgeWeight:-20,outsideImportance:-.5,boostWeight:100,ruleOfThirds:!0,prescale:!0,imageOperations:null,canvasFactory:l,debug:!1},b.crop=function(t,e,r){var a=f({},b.DEFAULTS,e);a.aspect&&(a.width=a.aspect,a.height=1),null===a.imageOperations&&(a.imageOperations=g(a.canvasFactory));var o=a.imageOperations,n=1,i=1;return o.open(t,a.input).then(function(t){return a.width&&a.height&&(n=k(t.width/a.width,t.height/a.height),a.cropWidth=~~(a.width*n),a.cropHeight=~~(a.height*n),a.minScale=k(a.maxScale,x(1/n,a.minScale)),a.prescale!==!1&&(i=1/n/a.minScale,i<1?(t=o.resample(t,t.width*i,t.height*i),a.cropWidth=~~(a.cropWidth*i),a.cropHeight=~~(a.cropHeight*i),a.boost&&(a.boost=a.boost.map(function(t){return{x:~~(t.x*i),y:~~(t.y*i),width:~~(t.width*i),height:~~(t.height*i),weight:t.weight}}))):i=1)),t}).then(function(t){return o.getData(t).then(function(t){for(var e=u(a,t),o=e.crops||[e.topCrop],n=0,h=o.length;n<h;n++){var s=o[n];s.x=~~(s.x/i),s.y=~~(s.y/i),s.width=~~(s.width/i),s.height=~~(s.height/i)}return r&&r(e),e})})},b.isAvailable=function(t){if(!b.Promise)return!1;var e=t?t.canvasFactory:l;if(e===l){var r=document.createElement("canvas");if(!r.getContext("2d"))return!1}return!0},b.importance=h,b.ImgData=d,b._downSample=c,b._canvasImageOperations=g;var k=Math.min,x=Math.max,C=Math.abs,y=(Math.ceil,Math.sqrt);"undefined"!=typeof define&&define.amd&&define(function(){return b}),"undefined"!=typeof exports?exports.smartcrop=b:"undefined"!=typeof navigator&&(window.SmartCrop=window.smartcrop=b),"undefined"!=typeof module&&(module.exports=b)}();var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),smartcrop=exports.smartcrop,DMCProfilePage=function(){function t(e){var r=this;_classCallCheck(this,t),this.root_=e,this.uploadButton_=this.root_.querySelector(".dmc-profile-avatar__change"),this.avatar_=this.root_.querySelector(".dmc-profile-avatar__media img"),this.onChange=function(t){var e=t.target.files;0!==e.length&&e[0].type.indexOf("image")!==-1||r.showError("No images selected");var a=new FileReader;a.onload=function(t){var e=new Image;e.onload=function(){r.crop(e).then(function(t){r.upload(t)})["catch"](function(t){r.showError(t.message||"Image cropping error")})},e.src=t.target.result},a.readAsDataURL(e[0])},this.uploadButton_.addEventListener("change",this.onChange)}return _createClass(t,null,[{key:"attachTo",value:function(e){return new t(e)}}]),_createClass(t,[{key:"crop",value:function(t,e){var r={minScale:1,width:256,height:256};return smartcrop.crop(t,r).then(function(e){var r=document.createElement("canvas");return r.width=256,r.height=256,r.getContext("2d").drawImage(t,e.topCrop.x,e.topCrop.y,e.topCrop.width,e.topCrop.height,0,0,256,256),r})}},{key:"upload",value:function(t){var e=this;this.uploadButton_.classList.toggle("dmc-profile-avatar__change--disabled");var r=new XMLHttpRequest;r.open("POST",window.location.search,!0),r.setRequestHeader("Turbolinks-Referrer",window.location),r.onload=function(t){var e=r.getResponseHeader("turbolinks-location"),a=window.Turbolinks.Snapshot.wrap(r.response);e||(e=window.location.href),window.Turbolinks.controller.adapter.hideProgressBar(),window.Turbolinks.controller.cache.put(e,a),window.Turbolinks.visit(e,{action:"restore"}),window.Turbolinks.clearCache(),r.status>299&&Turbolinks.controller.disable()},r.onerror=function(t){window.Turbolinks.controller.adapter.hideProgressBar(),e.uploadButton_.classList.toggle("dmc-profile-avatar__change--disabled"),e.showError("Request error")},window.Turbolinks.controller.adapter.showProgressBarAfterDelay(),t.toBlob(function(t){var a=new FormData(e.root_.querySelector("form"));a.append("avatar",t,"avatar.jpg"),r.send(a)})}},{key:"showError",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,r=new CustomEvent("DMCSnackbar:show",{detail:{message:t,timeout:e}});window.dispatchEvent(r)}},{key:"destroy",value:function(){this.uploadButton_.removeEventListener("change",this.onChange)}}]),t}();dmc.register("DMCProfilePage",DMCProfilePage);
//# sourceMappingURL=django-material-frontend-profile.min.js.map
