{"version":3,"sources":["smartcrop.js","profile.js"],"names":["smartcrop","Promise","Error","DEFAULTS","width","height","aspect","cropWidth","cropHeight","detailWeight","skinColor","skinBias","skinBrightnessMin","skinBrightnessMax","skinThreshold","skinWeight","saturationBrightnessMin","saturationBrightnessMax","saturationThreshold","saturationBias","saturationWeight","scoreDownSample","step","scaleStep","minScale","maxScale","edgeRadius","edgeWeight","outsideImportance","boostWeight","ruleOfThirds","prescale","imageOperations","canvasFactory","defaultCanvasFactory","debug","crop","inputImage","options_","callback","options","extend","canvasImageOperations","iop","scale","open","input","then","image","min","max","resample","boost","map","x","y","weight","getData","data","result","analyse","crops","topCrop","i","iLen","length","isAvailable","c","document","createElement","getContext","edgeDetect","o","id","od","w","h","p","lightness","sample","skinDetect","cie","skin","isSkinColor","isSkinBrightness","saturationDetect","sat","saturation","acceptableSaturation","acceptableLightness","applyBoosts","output","applyBoost","x0","x1","y0","y1","generateCrops","results","minDimension","push","score","detail","total","downSample","invDownSample","outputHeightDownSample","outputWidthDownSample","outputWidth","importance","px","abs","py","dx","Math","dy","d","s","sqrt","thirds","r","g","b","mag","rd","gd","bd","ImgData","scoreOutput","topScore","Infinity","debugOutput","debugOptions","debugTopCrop","Uint8ClampedArray","factor","idata","iwidth","floor","ifactor2","a","mr","mg","mb","v","u","j","_downSample","naturalWidth","naturalHeight","ctx","drawImage","resolve","getImageData","_canvasImageOperations","ceil","arguments","arg","name","maximum","minumum","l","define","amd","exports","navigator","window","SmartCrop","module","DMCProfilePage","root","root_","uploadButton_","querySelector","avatar_","onChange","event","files","target","type","indexOf","showError","reader","FileReader","onload","readerEvent","Image","cropCanvas","src","toDataURL","upload","catch","error","message","readAsDataURL","addEventListener","onSuccess","canvas","classList","toggle","xhr","XMLHttpRequest","location","search","setRequestHeader","getResponseHeader","snapshot","Turbolinks","Snapshot","wrap","response","href","controller","adapter","hideProgressBar","cache","put","visit","action","clearCache","status","disable","onerror","showProgressBarAfterDelay","toBlob","blob","formData","FormData","append","send","timeout","snackbarEvent","CustomEvent","dispatchEvent","removeEventListener","dmc","register"],"mappings":"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","file":"django-material-frontend-profile.js","sourcesContent":["/**\n * smartcrop.js\n * A javascript library implementing content aware image cropping\n *\n * Copyright (C) 2016 Jonas Wagner\n *\n * Permission is hereby granted, free of charge, to any person obtaining\n * a copy of this software and associated documentation files (the\n * \"Software\"), to deal in the Software without restriction, including\n * without limitation the rights to use, copy, modify, merge, publish,\n * distribute, sublicense, and/or sell copies of the Software, and to\n * permit persons to whom the Software is furnished to do so, subject to\n * the following conditions:\n *\n * The above copyright notice and this permission notice shall be\n * included in all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\n * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\n * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE\n * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION\n * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n */\n\n(function() {\n'use strict';\n\nvar smartcrop = {};\n// Promise implementation to use\nsmartcrop.Promise = typeof Promise !== 'undefined' ? Promise : function() {\n  throw new Error('No native promises and smartcrop.Promise not set.');\n};\n\nsmartcrop.DEFAULTS = {\n  width: 0,\n  height: 0,\n  aspect: 0,\n  cropWidth: 0,\n  cropHeight: 0,\n  detailWeight: 0.2,\n  skinColor: [0.78, 0.57, 0.44],\n  skinBias: 0.01,\n  skinBrightnessMin: 0.2,\n  skinBrightnessMax: 1.0,\n  skinThreshold: 0.8,\n  skinWeight: 1.8,\n  saturationBrightnessMin: 0.05,\n  saturationBrightnessMax: 0.9,\n  saturationThreshold: 0.4,\n  saturationBias: 0.2,\n  saturationWeight: 0.3,\n  // Step * minscale rounded down to the next power of two should be good\n  scoreDownSample: 8,\n  step: 8,\n  scaleStep: 0.1,\n  minScale: 1.0,\n  maxScale: 1.0,\n  edgeRadius: 0.4,\n  edgeWeight: -20.0,\n  outsideImportance: -0.5,\n  boostWeight: 100.0,\n  ruleOfThirds: true,\n  prescale: true,\n  imageOperations: null,\n  canvasFactory: defaultCanvasFactory,\n  // Factory: defaultFactories,\n  debug: false,\n};\n\n\n\nsmartcrop.crop = function(inputImage, options_, callback) {\n  var options = extend({}, smartcrop.DEFAULTS, options_);\n\n  if (options.aspect) {\n    options.width = options.aspect;\n    options.height = 1;\n  }\n\n  if (options.imageOperations === null) {\n    options.imageOperations = canvasImageOperations(options.canvasFactory);\n  }\n\n  var iop = options.imageOperations;\n\n  var scale = 1;\n  var prescale = 1;\n\n  return iop.open(inputImage, options.input).then(function(image) {\n\n    if (options.width && options.height) {\n      scale = min(image.width / options.width, image.height / options.height);\n      options.cropWidth = ~~(options.width * scale);\n      options.cropHeight = ~~(options.height * scale);\n      // Img = 100x100, width = 95x95, scale = 100/95, 1/scale > min\n      // don't set minscale smaller than 1/scale\n      // -> don't pick crops that need upscaling\n      options.minScale = min(options.maxScale, max(1 / scale, options.minScale));\n\n      if (options.prescale !== false) {\n        prescale = 1 / scale / options.minScale;\n        if (prescale < 1) {\n          image = iop.resample(image, image.width * prescale, image.height * prescale);\n          options.cropWidth = ~~(options.cropWidth * prescale);\n          options.cropHeight = ~~(options.cropHeight * prescale);\n          if (options.boost) {\n            options.boost = options.boost.map(function(boost) {\n              return {\n                x: ~~(boost.x * prescale),\n                y: ~~(boost.y * prescale),\n                width: ~~(boost.width * prescale),\n                height: ~~(boost.height * prescale),\n                weight: boost.weight\n              };\n            });\n          }\n        }\n        else {\n          prescale = 1;\n        }\n      }\n    }\n    return image;\n  })\n  .then(function(image) {\n    return iop.getData(image).then(function(data) {\n      var result = analyse(options, data);\n\n      var crops = result.crops || [result.topCrop];\n      for (var i = 0, iLen = crops.length; i < iLen; i++) {\n        var crop = crops[i];\n        crop.x = ~~(crop.x / prescale);\n        crop.y = ~~(crop.y / prescale);\n        crop.width = ~~(crop.width / prescale);\n        crop.height = ~~(crop.height / prescale);\n      }\n      if (callback) callback(result);\n      return result;\n    });\n  });\n};\n\n\n// Check if all the dependencies are there\n// todo:\nsmartcrop.isAvailable = function(options) {\n  if (!smartcrop.Promise) return false;\n\n  var canvasFactory = options ? options.canvasFactory : defaultCanvasFactory;\n\n  if (canvasFactory === defaultCanvasFactory) {\n    var c = document.createElement('canvas');\n    if (!c.getContext('2d')) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nfunction edgeDetect(i, o) {\n  var id = i.data;\n  var od = o.data;\n  var w = i.width;\n  var h = i.height;\n\n  for (var y = 0; y < h; y++) {\n    for (var x = 0; x < w; x++) {\n      var p = (y * w + x) * 4;\n      var lightness;\n\n      if (x === 0 || x >= w - 1 || y === 0 || y >= h - 1) {\n        lightness = sample(id, p);\n      }\n      else {\n        lightness = sample(id, p) * 4 -\n            sample(id, p - w * 4) -\n            sample(id, p - 4) -\n            sample(id, p + 4) -\n            sample(id, p + w * 4);\n      }\n\n      od[p + 1] = lightness;\n    }\n  }\n}\n\nfunction skinDetect(options, i, o) {\n  var id = i.data;\n  var od = o.data;\n  var w = i.width;\n  var h = i.height;\n\n  for (var y = 0; y < h; y++) {\n    for (var x = 0; x < w; x++) {\n      var p = (y * w + x) * 4;\n      var lightness = cie(id[p], id[p + 1], id[p + 2]) / 255;\n      var skin = skinColor(options, id[p], id[p + 1], id[p + 2]);\n      var isSkinColor = skin > options.skinThreshold;\n      var isSkinBrightness = lightness >= options.skinBrightnessMin && lightness <= options.skinBrightnessMax;\n      if (isSkinColor && isSkinBrightness) {\n        od[p] = (skin - options.skinThreshold) * (255 / (1 - options.skinThreshold));\n      }\n      else {\n        od[p] = 0;\n      }\n    }\n  }\n}\n\nfunction saturationDetect(options, i, o) {\n  var id = i.data;\n  var od = o.data;\n  var w = i.width;\n  var h = i.height;\n  for (var y = 0; y < h; y++) {\n    for (var x = 0; x < w; x++) {\n      var p = (y * w + x) * 4;\n\n      var lightness = cie(id[p], id[p + 1], id[p + 2]) / 255;\n      var sat = saturation(id[p], id[p + 1], id[p + 2]);\n\n      var acceptableSaturation = sat > options.saturationThreshold;\n      var acceptableLightness = lightness >= options.saturationBrightnessMin &&\n          lightness <= options.saturationBrightnessMax;\n      if (acceptableLightness && acceptableLightness) {\n        od[p + 2] = (sat - options.saturationThreshold) * (255 / (1 - options.saturationThreshold));\n      }\n      else {\n        od[p + 2] = 0;\n      }\n    }\n  }\n}\n\nfunction applyBoosts(options, output) {\n  if (!options.boost) return;\n  var od = output.data;\n  for (var i = 0; i < output.width; i += 4) {\n    od[i + 3] = 0;\n  }\n  for (i = 0; i < options.boost.length; i++) {\n    applyBoost(options.boost[i], options, output);\n  }\n}\n\nfunction applyBoost(boost, options, output) {\n  var od = output.data;\n  var w = output.width;\n  var x0 = ~~boost.x;\n  var x1 = ~~(boost.x + boost.width);\n  var y0 = ~~boost.y;\n  var y1 = ~~(boost.y + boost.height);\n  var weight = boost.weight * 255;\n  for (var y = y0; y < y1; y++) {\n    for (var x = x0; x < x1; x++) {\n      var i = (y * w + x) * 4;\n      od[i + 3] += weight;\n    }\n  }\n}\n\nfunction generateCrops(options, width, height) {\n  var results = [];\n  var minDimension = min(width, height);\n  var cropWidth = options.cropWidth || minDimension;\n  var cropHeight = options.cropHeight || minDimension;\n  for (var scale = options.maxScale; scale >= options.minScale; scale -= options.scaleStep) {\n    for (var y = 0; y + cropHeight * scale <= height; y += options.step) {\n      for (var x = 0; x + cropWidth * scale <= width; x += options.step) {\n        results.push({\n          x: x,\n          y: y,\n          width: cropWidth * scale,\n          height: cropHeight * scale,\n        });\n      }\n    }\n  }\n  return results;\n}\n\nfunction score(options, output, crop) {\n  var result = {\n    detail: 0,\n    saturation: 0,\n    skin: 0,\n    boost: 0,\n    total: 0,\n  };\n\n  var od = output.data;\n  var downSample = options.scoreDownSample;\n  var invDownSample = 1 / downSample;\n  var outputHeightDownSample = output.height * downSample;\n  var outputWidthDownSample = output.width * downSample;\n  var outputWidth = output.width;\n\n  for (var y = 0; y < outputHeightDownSample; y += downSample) {\n    for (var x = 0; x < outputWidthDownSample; x += downSample) {\n      var p = (~~(y * invDownSample) * outputWidth + ~~(x * invDownSample)) * 4;\n      var i = importance(options, crop, x, y);\n      var detail = od[p + 1] / 255;\n\n      result.skin += od[p] / 255 * (detail + options.skinBias) * i;\n      result.detail += detail * i;\n      result.saturation += od[p + 2] / 255 * (detail + options.saturationBias) * i;\n      result.boost += od[p + 3] / 255 * i;\n    }\n  }\n\n  result.total = (result.detail * options.detailWeight +\n                  result.skin * options.skinWeight +\n                  result.saturation * options.saturationWeight +\n                  result.boost * options.boostWeight) / (crop.width * crop.height);\n  return result;\n}\n\nfunction importance(options, crop, x, y) {\n  if (crop.x > x || x >= crop.x + crop.width || crop.y > y || y >= crop.y + crop.height) {\n    return options.outsideImportance;\n  }\n  x = (x - crop.x) / crop.width;\n  y = (y - crop.y) / crop.height;\n  var px = abs(0.5 - x) * 2;\n  var py = abs(0.5 - y) * 2;\n  // Distance from edge\n  var dx = Math.max(px - 1.0 + options.edgeRadius, 0);\n  var dy = Math.max(py - 1.0 + options.edgeRadius, 0);\n  var d = (dx * dx + dy * dy) * options.edgeWeight;\n  var s = 1.41 - sqrt(px * px + py * py);\n  if (options.ruleOfThirds) {\n    s += (Math.max(0, s + d + 0.5) * 1.2) * (thirds(px) + thirds(py));\n  }\n  return s + d;\n}\nsmartcrop.importance = importance;\n\nfunction skinColor(options, r, g, b) {\n  var mag = sqrt(r * r + g * g + b * b);\n  var rd = (r / mag - options.skinColor[0]);\n  var gd = (g / mag - options.skinColor[1]);\n  var bd = (b / mag - options.skinColor[2]);\n  var d = sqrt(rd * rd + gd * gd + bd * bd);\n  return 1 - d;\n}\n\nfunction analyse(options, input) {\n  var result = {};\n  var output = new ImgData(input.width, input.height);\n\n  edgeDetect(input, output);\n  skinDetect(options, input, output);\n  saturationDetect(options, input, output);\n  applyBoosts(options, output);\n\n  var scoreOutput = downSample(output, options.scoreDownSample);\n\n  var topScore = -Infinity;\n  var topCrop = null;\n  var crops = generateCrops(options, input.width, input.height);\n\n  for (var i = 0, iLen = crops.length; i < iLen; i++) {\n    var crop = crops[i];\n    crop.score = score(options, scoreOutput, crop);\n    if (crop.score.total > topScore) {\n      topCrop = crop;\n      topScore = crop.score.total;\n    }\n\n  }\n\n  result.topCrop = topCrop;\n\n  if (options.debug && topCrop) {\n    result.crops = crops;\n    result.debugOutput = output;\n    result.debugOptions = options;\n    // Create a copy which will not be adjusted by the post scaling of smartcrop.crop\n    result.debugTopCrop = extend({}, result.topCrop);\n  }\n  return result;\n}\n\nfunction ImgData(width, height, data) {\n  this.width = width;\n  this.height = height;\n  if (data) {\n    this.data = new Uint8ClampedArray(data);\n  }\n  else {\n    this.data = new Uint8ClampedArray(width * height * 4);\n  }\n}\nsmartcrop.ImgData = ImgData;\n\nfunction downSample(input, factor) {\n  var idata = input.data;\n  var iwidth = input.width;\n  var width = Math.floor(input.width / factor);\n  var height = Math.floor(input.height / factor);\n  var output = new ImgData(width, height);\n  var data = output.data;\n  var ifactor2 = 1 / (factor * factor);\n  for (var y = 0; y < height; y++) {\n    for (var x = 0; x < width; x++) {\n      var i = (y * width + x) * 4;\n\n      var r = 0;\n      var g = 0;\n      var b = 0;\n      var a = 0;\n\n      var mr = 0;\n      var mg = 0;\n      var mb = 0;\n\n      for (var v = 0; v < factor; v++) {\n        for (var u = 0; u < factor; u++) {\n          var j = ((y * factor + v) * iwidth + (x * factor + u)) * 4;\n          r += idata[j];\n          g += idata[j + 1];\n          b += idata[j + 2];\n          a += idata[j + 3];\n          mr = Math.max(mr, idata[j]);\n          mg = Math.max(mg, idata[j + 1]);\n          mb = Math.max(mb, idata[j + 2]);\n        }\n      }\n      // this is some funky magic to preserve detail a bit more for\n      // skin (r) and detail (g). Saturation (b) does not get this boost.\n      data[i] = r * ifactor2 * 0.5 + mr * 0.5;\n      data[i + 1] = g * ifactor2 * 0.7 + mg * 0.3;\n      data[i + 2] = b * ifactor2;\n      data[i + 3] = a * ifactor2;\n    }\n  }\n  return output;\n}\nsmartcrop._downSample = downSample;\n\nfunction defaultCanvasFactory(w, h) {\n  var c = document.createElement('canvas');\n  c.width = w;\n  c.height = h;\n  return c;\n}\n\nfunction canvasImageOperations(canvasFactory) {\n  return {\n    // Takes imageInput as argument\n    // returns an object which has at least\n    // {width: n, height: n}\n    open: function(image) {\n      // Work around images scaled in css by drawing them onto a canvas\n      var w = image.naturalWidth || image.width;\n      var h = image.naturalHeight || image.height;\n      var c = canvasFactory(w, h);\n      var ctx = c.getContext('2d');\n      if (image.naturalWidth && (image.naturalWidth != image.width || image.naturalHeight != image.height)) {\n        c.width = image.naturalWidth;\n        c.height = image.naturalHeight;\n      }\n      else {\n        c.width = image.width;\n        c.height = image.height;\n      }\n      ctx.drawImage(image, 0, 0);\n      return smartcrop.Promise.resolve(c);\n    },\n    // Takes an image (as returned by open), and changes it's size by resampling\n    resample: function(image, width, height) {\n      return Promise.resolve(image).then(function(image) {\n        var c = canvasFactory(~~width, ~~height);\n        var ctx = c.getContext('2d');\n\n        ctx.drawImage(image, 0, 0, image.width, image.height, 0, 0, c.width, c.height);\n        return smartcrop.Promise.resolve(c);\n      });\n    },\n    getData: function(image) {\n      return Promise.resolve(image).then(function(c) {\n        var ctx = c.getContext('2d');\n        var id = ctx.getImageData(0, 0, c.width, c.height);\n        return new ImgData(c.width, c.height, id.data);\n      });\n    },\n  };\n}\nsmartcrop._canvasImageOperations = canvasImageOperations;\n\n// Aliases and helpers\nvar min = Math.min;\nvar max = Math.max;\nvar abs = Math.abs;\nvar ceil = Math.ceil;\nvar sqrt = Math.sqrt;\n\nfunction extend(o) {\n  for (var i = 1, iLen = arguments.length; i < iLen; i++) {\n    var arg = arguments[i];\n    if (arg) {\n      for (var name in arg) {\n        o[name] = arg[name];\n      }\n    }\n  }\n  return o;\n}\n\n// Gets value in the range of [0, 1] where 0 is the center of the pictures\n// returns weight of rule of thirds [0, 1]\nfunction thirds(x) {\n  x = ((x - (1 / 3) + 1.0) % 2.0 * 0.5 - 0.5) * 16;\n  return Math.max(1.0 - x * x, 0.0);\n}\n\nfunction cie(r, g, b) {\n  return 0.5126 * b + 0.7152 * g + 0.0722 * r;\n}\nfunction sample(id, p) {\n  return cie(id[p], id[p + 1], id[p + 2]);\n}\nfunction saturation(r, g, b) {\n  var maximum = max(r / 255, g / 255, b / 255);\n  var minumum = min(r / 255, g / 255, b / 255);\n\n  if (maximum === minumum) {\n    return 0;\n  }\n\n  var l = (maximum + minumum) / 2;\n  var d = maximum - minumum;\n\n  return l > 0.5 ? d / (2 - maximum - minumum) : d / (maximum + minumum);\n}\n\n// Amd\nif (typeof define !== 'undefined' && define.amd) define(function() {return smartcrop;});\n// Common js\nif (typeof exports !== 'undefined') exports.smartcrop = smartcrop;\n// Browser\nelse if (typeof navigator !== 'undefined') window.SmartCrop = window.smartcrop = smartcrop;\n// Nodejs\nif (typeof module !== 'undefined') {\n  module.exports = smartcrop;\n}\n})();\n","class DMCProfilePage {\n  static attachTo(root) {\n    return new DMCProfilePage(root);\n  }\n\n  constructor(root) {\n    this.root_ = root;\n    this.uploadButton_ = this.root_.querySelector('.dmc-profile-avatar__change');\n    this.avatar_ = this.root_.querySelector('.dmc-profile-avatar__media img');\n    this.onChange = (event) => {\n      let files = event.target.files;\n      if (files.length === 0 || files[0].type.indexOf('image') === -1) {\n        this.showError('No images selected');\n      }\n\n      let reader = new FileReader();\n      reader.onload = (readerEvent) => {\n        let image = new Image();\n        image.onload = () => {\n          this.crop(image).then((cropCanvas) => {\n            this.avatar_.src=cropCanvas.toDataURL('image/png');\n            this.upload(cropCanvas);\n          }).catch((error) => {\n            this.showError(error.message || 'Image cropping error');\n          });\n        };\n        image.src = readerEvent.target.result;\n      };\n      reader.readAsDataURL(files[0]);\n    };\n\n    this.uploadButton_.addEventListener('change', this.onChange);\n  }\n\n  crop(image, onSuccess) {\n    let options = {\n      minScale: 1,\n      width: 256,\n      height: 256,\n    };\n    return SmartCrop.crop(image, options).then((result) => {\n      let cropCanvas = document.createElement('canvas');\n      cropCanvas.width = 256;\n      cropCanvas.height = 256;\n      cropCanvas.getContext('2d').drawImage(\n        image,\n        result.topCrop.x, result.topCrop.y, result.topCrop.width, result.topCrop.height,\n        0, 0, 256, 256\n      );\n      return cropCanvas;\n    });\n  }\n\n  upload(canvas) {\n    this.uploadButton_.classList.toggle('dmc-profile-avatar__change--disabled');\n\n    let xhr = new XMLHttpRequest();\n    xhr.open('POST', window.location.search, true);\n    xhr.setRequestHeader('Turbolinks-Referrer', window.location);\n\n    xhr.onload = (event) => {\n      let location = xhr.getResponseHeader('turbolinks-location');\n      let snapshot = window.Turbolinks.Snapshot.wrap(xhr.response);\n\n      if (!location) {\n        location = window.location.href;\n      }\n\n      window.Turbolinks.controller.adapter.hideProgressBar();\n      window.Turbolinks.controller.cache.put(location, snapshot);\n      window.Turbolinks.visit(location, {action: 'restore'});\n      window.Turbolinks.clearCache();\n\n      if (xhr.status > 299) {\n        Turbolinks.controller.disable();\n      }\n    };\n\n    xhr.onerror = (event) => {\n      window.Turbolinks.controller.adapter.hideProgressBar();\n      this.uploadButton_.classList.toggle('dmc-profile-avatar__change--disabled');\n      this.showError('Request error');\n    };\n\n    window.Turbolinks.controller.adapter.showProgressBarAfterDelay();\n\n    canvas.toBlob((blob) => {\n      let formData = new FormData(this.root_.querySelector('form'));\n      formData.append('avatar', blob, 'avatar.jpg');\n      xhr.send(formData);\n    });\n  }\n\n  showError(message, timeout=2000) {\n    let snackbarEvent = new CustomEvent('DMCSnackbar:show', {\n      'detail': {message: message, timeout: timeout},\n    });\n    window.dispatchEvent(snackbarEvent);\n  }\n\n  destroy() {\n    this.uploadButton_.removeEventListener('change', this.onChange);\n  }\n}\n\ndmc.register('DMCProfilePage', DMCProfilePage);\n"]}